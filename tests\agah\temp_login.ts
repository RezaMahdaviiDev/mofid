/**
 * ุงุณฺฉุฑูพุช ุชุณุช ูุงฺฏู (ูููุช)
 * ุงู ูุงู ุจุฑุง ฺฉโุจุงุฑ ุงููู ุงุณุชูุงุฏู ูโุดูุฏ ุชุง ฺฉุงุฑุจุฑ ูุงุฑุฏ ุญุณุงุจ ุฎูุฏ ุดูุฏ
 * ู ุณูพุณ Session ุฐุฎุฑู ุดูุฏ. ุจุนุฏ ุงุฒ ุชุงุฏ ููููุชโุขูุฒุ ุงู ูุงู ุญุฐู ุฎูุงูุฏ ุดุฏ.
 */

import { BrowserManager } from '../src/core/browser';

async function testLogin() {
  const browserManager = new BrowserManager();

  try {
    console.log('========================================');
    console.log('๐ ุงุณฺฉุฑูพุช ุชุณุช ูุงฺฏู');
    console.log('========================================\n');

    // ุจุงุฒ ฺฉุฑุฏู ูุฑูุฑฺฏุฑ (ุฏุฑ ุญุงูุช ฺฏุฑุงูฺฉ)
    const page = await browserManager.launch(false);

    // ุฑูุชู ุจู ุตูุญู ูุงฺฏู ุขุณุงุชุฑุฏุฑ
    console.log('๐ ุฏุฑ ุญุงู ุฑูุชู ุจู ุตูุญู ูุงฺฏู ุขุณุงุชุฑุฏุฑ...');
    await page.goto('https://online.agah.com/auth/login');

    console.log('\nโณ ูุทูุงู ูุงุฑุฏ ุญุณุงุจ ฺฉุงุฑุจุฑ ุฎูุฏ ุดูุฏ...');
    console.log('   (ฺฉูพฺุง ุฑุง ุญู ฺฉูุฏุ ูุงู ฺฉุงุฑุจุฑ ู ุฑูุฒ ุนุจูุฑ ุฑุง ูุงุฑุฏ ฺฉูุฏ)');
    console.log('   ุจุนุฏ ุงุฒ ูุฑูุฏุ ุจู ุตูุญู ุฏุงุฑุงโูุง ุจุฑูุฏ (Portfolio)');
    console.log('   ุณูพุณ ุฏุฑ ุชุฑููุงู Enter ุจุฒูุฏ ุชุง Session ุฐุฎุฑู ุดูุฏ.\n');

    // ุงูุชุธุงุฑ ุจุฑุง ูุดุฑุฏู Enter ุชูุณุท ฺฉุงุฑุจุฑ
    console.log('โจ๏ธ  ุจุนุฏ ุงุฒ ูุงฺฏูุ Enter ุจุฒูุฏ...');
    await new Promise<void>((resolve) => {
      process.stdin.once('data', () => {
        resolve();
      });
    });

    console.log('โ ูุงฺฏู ุชุงุฏ ุดุฏ!');
    console.log('๐พ ุฏุฑ ุญุงู ุฐุฎุฑู Session...');

    // ุฐุฎุฑู ฺฉุฑุฏู Session
    await browserManager.saveSession();

    console.log('\nโ Session ุจุง ููููุช ุฐุฎุฑู ุดุฏ!');
    console.log('   ุงุฒ ุงู ุจู ุจุนุฏ ุฏฺฏุฑ ูุงุฒ ุจู ูุงฺฏู ูุณุช.');
    console.log('\n๐ ุชุณุช ูุงฺฏู ุจู ูพุงุงู ุฑุณุฏ.');

    // 3 ุซุงูู ุตุจุฑ ูโฺฉูู ุชุง ฺฉุงุฑุจุฑ ูพุงู ุฑุง ุจุจูุฏ
    await page.waitForTimeout(3000);

  } catch (error: any) {
    console.error('\nโ ุฎุทุง ุฏุฑ ูุฑุขูุฏ ูุงฺฏู:', error.message);
    console.log('\nุงฺฏุฑ ุฒูุงู ุจู ูพุงุงู ุฑุณุฏุ ุฏูุจุงุฑู ุงุณฺฉุฑูพุช ุฑุง ุงุฌุฑุง ฺฉูุฏ.');
  } finally {
    await browserManager.close();
  }
}

// ุงุฌุฑุง ุชุณุช
testLogin();

